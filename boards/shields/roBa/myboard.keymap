// myboard.keymap
// ざっくり 5 行 × 12 列 = 60 キー分のスケルトン
// XXX は未使用キー（&none）のエイリアス

#define XXX &none

/ {
    // ---------- マクロ定義 ----------
    macros {
        // ; + Enter を送るマクロ
        semicolon_enter: semicolon_enter {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <
                &kp SEMI    // ;
                &kp ENTER   // Enter
            >;
        };
    };

    // ---------- 振る舞い定義 ----------
    behaviors {

        bspc_imeoff_ht: bspc_imeoff_ht {
            compatible = "zmk,behavior-hold-tap";
            label = "BSPC_IMEOFF_HT";
            #binding-cells = <2>;

            flavor = "tap-preferred";
            tapping-term-ms = <200>;

            // hold: IME OFF / tap: Backspace
            bindings = <&kp IME_OFF>, <&kp BSPC>;
        };

        space_imeon_ht: space_imeon_ht {
            compatible = "zmk,behavior-hold-tap";
            label = "SPACE_IMEON_HT";
            #binding-cells = <2>;

            flavor = "tap-preferred";
            tapping-term-ms = <200>;

            // hold: IME ON / tap: Space
            bindings = <&kp IME_ON>, <&kp SPACE>;
        };

        enter_semienter_ht: enter_semienter_ht {
            compatible = "zmk,behavior-hold-tap";
            label = "ENTER_SEMIENTER_HT";
            #binding-cells = <2>;

            flavor = "tap-preferred";
            tapping-term-ms = <200>;

            // hold: ; + Enter（既存マクロ） / tap: Enter
            bindings = <&semicolon_enter>, <&kp ENTER>;
        };


    };

    // ---------- レイヤ定義 ----------
    keymap {
        compatible = "zmk,keymap";

        // ==============================
        // LAYER 0: ベースレイヤ
        // KLE の 0〜4 行 に相当
        // ==============================
        default_layer {
            bindings = <
                // row 0 (12)
                &kp ESC   &kp P   &kp E   &kp U   &kp G   XXX
                &kp C     &kp R   &kp L   &kp MINUS &kp DEL XXX

                // row 1 (12)
                &kp TAB   &kp Y   &kp I   &kp A   &kp O   XXX
                &kp D     &kp T   &kp N   &kp S   &kp H    &enter_semienter_ht

                // row 2 (12)
                &kp LSHFT &kp Q   &kp J   &kp K   &kp X   &kp F
                &kp B     &kp M   &kp W   &kp V   &kp Z   &kp RSHFT

                // row 3 (12)
                &kp LCTRL &kp LALT &kp LGUI XXX XXX XXX
                XXX XXX XXX XXX XXX &kp PSCRN

                // row 4 (12)
                // 左：マウス(layer3) / Fn(layer2) / 右：記号(layer1)
                &mo 3     &mo 2   &bspc_imeoff_ht XXX XXX XXX
                XXX       &space_imeon_ht &mo 1   XXX XXX XXX
                >;
            };


        // ==============================
        // LAYER 1: 記号／数字レイヤ
        // KLE の 5〜9 行 相当
        // ==============================
        symbol_layer {
            bindings = <
                // row 0 (12)
                &kp N1 &kp N2 &kp N3 &kp N4 &kp N5 &kp N6
                &kp N7 &kp N8 &kp N9 &kp N0 XXX XXX

                // row 1 (12)
                &kp TAB XXX &kp SEMI &kp COMMA &kp DOT &kp MINUS
                &kp LBKT &kp RBKT XXX XXX &kp ENTER XXX

                // row 2 (12)
                &kp LSHFT XXX XXX XXX XXX XXX
                XXX XXX XXX XXX XXX &kp RSHFT

                // row 3 (12)
                &kp LCTRL XXX &kp LGUI XXX XXX XXX
                XXX XXX XXX XXX XXX &kp DEL

                // row 4 (12)  ※ベースと同じ
                &mo 3 &mo 2 &bspc_imeoff_ht XXX XXX XXX
                XXX   &space_imeon_ht &mo 1 XXX XXX XXX
            >;
        };

        // ==============================
        // LAYER 2: Fn / ショートカットレイヤ
        // KLE の 10〜14 行 相当
        // ==============================
        fn_layer {
            bindings = <
                // row 0 (12)
                &kp F1 &kp F2 &kp F3 &kp F4 &kp F5 &kp F6
                &kp F7 &kp F8 &kp F9 &kp F10 XXX XXX

                // row 1 (12)
                &kp TAB &kp LC(Z) &kp LC(X) &kp LC(C) &kp LC(V) &kp F11
                &kp F12 &kp LC(F) &kp LC(H) &kp LC(SLASH) &kp ENTER XXX

                // row 2 (12)
                &kp LSHFT &kp LC(A) &kp LC(S) &kp LC(D) &kp LC(W) XXX
                &kp LC(LEFT) &kp LC(RIGHT) &kp HOME &kp END XXX &kp RSHFT

                // row 3 (12)
                &kp LCTRL &kp LALT &kp LGUI &kp DEL &kp LC(BSPC) XXX
                XXX XXX XXX XXX XXX XXX

                // row 4 (12)
                &mo 3 &mo 2 &bspc_imeoff_ht XXX XXX XXX
                XXX   &space_imeon_ht &mo 1 XXX XXX XXX
            >;
        };

        // ==============================
        // LAYER 3: 予備　左右クリックなど
        // ==============================
        mouse_layer {
            bindings = <
                // row 0 (12)
                XXX XXX XXX XXX XXX XXX
                XXX XXX XXX XXX XXX XXX

                // row 1 (12)
                XXX XXX XXX XXX XXX XXX
                XXX XXX XXX XXX XXX XXX

                // row 2 (12)
                XXX XXX XXX XXX XXX XXX
                XXX XXX XXX XXX XXX XXX

                // row 3 (12) クリックを押しやすい場所に置く例（右側の終端2つ）
                XXX XXX XXX XXX XXX XXX
                XXX XXX XXX XXX &mkp LCLK &mkp RCLK

                // row 4 (12) 親指はベースと同じ
                &mo 3 &mo 2 &bspc_imeoff_ht XXX XXX XXX
                XXX   &space_imeon_ht &mo 1 XXX XXX XXX
            >;
        };
    };
};
